АНАЛИЗ LEGACY PHP-КОДА

Пример legacy-кода:
<?php
$username = $_GET['user'];
$conn = mysql_connect("localhost", "root", "");
mysql_select_db("test", $conn);
$query = "SELECT * FROM users WHERE name = '$username'";
$result = mysql_query($query);
while ($row = mysql_fetch_array($result)) {
    echo "<div>Пользователь: " . $row['name'] . "</div>";
}
?>

Выявленные проблемы:
1. Уязвимость к SQL-инъекциям:
   - Данные из $_GET используются напрямую в SQL-запросе без фильтрации
   - Пример атаки: ?user=' OR '1'='1

2. Смешение логики и представления:
   - Работа с базой данных и вывод HTML находятся в одном файле
   - Нет разделения на слои (бизнес-логика, представление)

3. Устаревшие функции:
   - Используется расширение mysql_*, которое удалено в PHP 7+
   - Отсутствует обработка ошибок подключения к БД

4. Отсутствие базовой безопасности:
   - Нет валидации входных данных
   - Нет экранирования вывода (XSS-уязвимость)
   - Учетные данные БД хранятся в коде

Рефакторинг:
- Использовать PDO с параметризованными запросами
- Вынести логику в отдельные классы (MVC)
- Применить фильтрацию входных данных (filter_var)
- Использовать шаблонизатор для разделения логики и представления
- Вынести конфигурацию БД в отдельный файл